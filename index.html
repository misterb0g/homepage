x<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Homepage</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Import de SortableJS pour le Drag & Drop -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="/favicon.ico" sizes="any">

  <style>
    /* --- Animations globales --- */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px) scale(0.98); filter: blur(8px); }
      to { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
    }
    
    /* On garde l'animation mais on s'assure qu'elle ne g√™ne pas le drag & drop apr√®s */
    .bookmark-set, #news-container {
      opacity: 0; 
      animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
      will-change: transform, opacity, filter;
    }
    #news-container { animation-delay: 0.1s; }

    #weather-details:not([hidden]) {
      animation: fadeInUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
    }
  </style>
</head>
<body data-theme="dark" data-density="cozy">

  <!-- Background Blobs -->
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>

  <!-- Header / Top Bar -->
  <header>
    <div class="left-col">
      <div id="greeting">Bonjour</div>
      <div id="clock">00:00</div>
    </div>
    
    <div class="right-col">
       <!-- Weather Widget -->
       <div id="weather-widget">
        <span id="weather-icon">--</span>
        <span id="weather-temp">--¬∞</span>
      </div>
       <!-- Settings Toggle -->
       <button id="settings-btn" aria-label="Settings">
        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
      </button>
    </div>
  </header>

  <!-- Weather Details Overlay -->
  <div id="weather-details" hidden>
    <div class="weather-header">
      <h3>M√©t√©o Locale</h3>
      <button id="close-weather" aria-label="Fermer">‚úï</button>
    </div>
    <div class="weather-content">
      <div class="main-temp">
        <span id="detail-icon"></span>
        <span id="detail-temp">--¬∞</span>
      </div>
      <p id="detail-desc">Chargement...</p>
      <div class="weather-grid">
        <div class="w-item"><span>Humidit√©</span><strong id="detail-humidity">--%</strong></div>
        <div class="w-item"><span>Vent</span><strong id="detail-wind">-- km/h</strong></div>
        <div class="w-item"><span>Ressenti</span><strong id="detail-feels">--¬∞</strong></div>
      </div>
    </div>
  </div>

  <!-- Settings Panel -->
  <div id="settings-panel" class="glass-panel" hidden>
    <div class="panel-header">
      <h3>Pr√©f√©rences</h3>
      <button id="close-settings">‚úï</button>
    </div>
    
    <div class="setting-group">
      <label>Th√®me</label>
      <select id="theme-selector">
        <option value="light">Clair</option>
        <option value="dark">Sombre</option>
      </select>
    </div>

    <div class="setting-group">
      <label>Densit√©</label>
      <select id="density-selector">
        <option value="cozy">Confortable</option>
        <option value="compact">Compact</option>
      </select>
    </div>

    <div class="setting-group checkbox-group">
      <label>Afficher les News</label>
      <label class="toggle-switch">
        <input type="checkbox" id="news-toggle" checked>
        <span class="slider"></span>
      </label>
    </div>

    <div class="setting-group checkbox-group">
        <label>Afficher le Chat</label>
        <label class="toggle-switch">
          <input type="checkbox" id="chat-toggle" checked>
          <span class="slider"></span>
        </label>
      </div>
      
    <div class="panel-footer">
      <button id="reset-settings">R√©initialiser</button>
    </div>
  </div>

  <!-- Main Container -->
  <main>
    <!-- Bookmarks Grid -->
    <div id="bookmarks-container"></div>

    <!-- News Section -->
    <div id="news-container">
      <h2>√Ä la une</h2>
      <div id="news-grid">Chargement des actualit√©s...</div>
    </div>
  </main>

  <!-- Chat Widget (Embed) -->
  <iframe 
    src="https://www.chatbase.co/chatbot-iframe/HuA2t4q1t4u6o6s6u2t5"
    title="Chatbot"
    width="100%"
    style="height: 100%; min-height: 700px; border: none;"
    frameborder="0"
    id="chat-widget"
  ></iframe>

  <!-- Scripts -->
  <script type="module">
    // Donn√©es des favoris int√©gr√©es directement (remplace bookmarks.js)
    const bookmarks = [
      {
        title: "Ressources Humaines",
        links: [
          { name: "DinClock", url: "https://www.dinclock.com/silex/login/home.jsp" },
          { name: "Partena", url: "https://my.partena-professional.be" },
          { name: "Edenred", url: "https://www.myedenred.be/#/" },
          { name: "My Actiris", url: "https://my.actiris.brussels/subsidized-jobs/dashboard/employeur/" },
        ]
      },
      {
        title: "Administration",
        links: [
          { name: "Dolibarr", url: "https://dolibarr.lesilex.be" },
          { name: "Flow", url: "https://admin.joinflow.com/pbxservices.jsp" },
          { name: "Odoo", url: "https://silex-asbl.odoo.com/odoo" },
          { name: "Cl√©", url: "https://airkey.evva.com" },
        ]
      },
      {
        title: "Banques & Finance",
        links: [
          { name: "ING", url: "https://ebanking.ing.be/login" },
          { name: "Winbooks", url: "https://app.winbooksconnect.be/" },
          { name: "Fortis", url: "https://www.bnpparibasfortis.be/fr/generic/logon" },
        ]
      },
      {
        title: "Media",
        links: [
          { name: "Netflix", url: "https://netflix.com" },
          { name: "Disney +", url: "https://www.disneyplus.com/fr-fr/home" },
          { name: "Canal+", url: "https://pass.canalplus.com/" },
        ]
      },
      {
        title: "News",
        links: [
          { name: "Club MacG", url: "https://clubigen.fr" },
          { name: "Courrier Inter", url: "https://www.courrierinternational.com" },
          { name: "Le Soir", url: "https://www.lesoir.be" },
          { name: "RTBF", url: "https://www.rtbf.be" },
        ]
      },
      {
        title: "Sport",
        links: [
          { name: "Strava", url: "https://www.strava.com/login" },
          { name: "Garmin", url: "https://connect.garmin.com/modern/" },
          { name: "Smashrun", url: "https://fr.smashrun.com/gilles.bogarts" },
        ]
      },
      {
        title: "Web-admin",
        links: [
          { name: "Silex", url: "http://lesilex.be/admin/login.php" },
          { name: "Fleur d'√î", url: "https://fleurdo.be/wp-login.php" },
        ]
      }
    ];

    // Utilitaires
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => document.querySelectorAll(sel);
    
    // --- Gestion du temps ---
    function getTime() {
      const now = new Date();
      return now.toLocaleTimeString('fr-BE', { hour: '2-digit', minute: '2-digit' });
    }
    
    function updateGreeting() {
      const h = new Date().getHours();
      const txt = h < 12 ? "Bonjour," : h < 18 ? "Bon apr√®s-midi," : "Bonsoir,";
      $("#greeting").innerText = txt;
    }

    // --- M√©t√©o (OpenMeteo - Pas de cl√© API requise) ---
    // Latitude/Longitude pour Bruxelles (Zaventem approx)
    const LAT = 50.8503; 
    const LON = 4.3517;

    async function getWeather() {
      try {
        const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true`);
        const data = await res.json();
        const w = data.current_weather;
        
        // Mapping codes WMO
        const iconMap = {
          0: '‚òÄÔ∏è', 1: 'üå§', 2: '‚õÖÔ∏è', 3: '‚òÅÔ∏è',
          45: 'üå´', 48: 'üå´', 51: 'üåß', 61: 'üåß', 80: 'üåß',
          95: '‚õà', 71: '‚ùÑÔ∏è'
        };
        const icon = iconMap[w.weathercode] || 'üå•';
        
        // Widget Header
        $("#weather-icon").innerText = icon;
        $("#weather-temp").innerText = `${Math.round(w.temperature)}¬∞`;

        // Details Overlay
        $("#detail-icon").innerText = icon;
        $("#detail-temp").innerText = `${Math.round(w.temperature)}¬∞`;
        $("#detail-desc").innerText = "M√©t√©o actuelle"; 
        $("#detail-wind").innerText = `${w.windspeed} km/h`;
        
        // Note: OpenMeteo basic free doesn't give humidity in current_weather easily without more params, 
        // kept simple here or fetch hourly[0]
        $("#detail-humidity").innerText = "-"; 
        $("#detail-feels").innerText = `${Math.round(w.temperature)}¬∞`; // Simplification

      } catch (e) {
        console.error("M√©t√©o error", e);
      }
    }

    // --- News (RSS via un proxy ou API) ---
    // Pour l'exemple static, on mock ou on utilise un service RSS to JSON public
    async function loadNews() {
      const container = $("#news-grid");
      // Exemple : Utilisation de rss2json pour Le Soir ou RTBF
      const RSS_URL = "https://rss.lesoir.be/belgique"; 
      const API = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(RSS_URL)}`;
      
      try {
        const res = await fetch(API);
        const data = await res.json();
        if(data.status === 'ok') {
          container.innerHTML = data.items.slice(0, 4).map(item => `
            <a href="${item.link}" target="_blank" class="news-card">
              <div class="news-content">
                <h3>${item.title}</h3>
                <p>${new Date(item.pubDate).toLocaleDateString('fr-BE')}</p>
              </div>
            </a>
          `).join('');
        }
      } catch(e) {
        container.innerHTML = '<p class="error">Impossible de charger les news.</p>';
      }
    }

    // --- Bookmarks & Drag and Drop ---
    function setupBookmarks() {
      const container = $("#bookmarks-container");
      container.innerHTML = "";

      // 1. R√©cup√©rer l'ordre sauvegard√©
      const savedOrder = JSON.parse(localStorage.getItem('bookmarksOrder'));
      
      let displayList = [];

      if (savedOrder && savedOrder.length > 0) {
        // Trier les favoris selon l'ordre sauvegard√©
        // Note: bookmarks est maintenant la variable locale d√©finie ci-dessus
        displayList = savedOrder.map(title => bookmarks.find(b => b.title === title)).filter(Boolean);
        
        // Ajouter les nouveaux favoris qui ne seraient pas dans le stockage (cas o√π tu ajoutes une cat dans le JS)
        bookmarks.forEach(b => {
            if (!savedOrder.includes(b.title)) {
                displayList.push(b);
            }
        });
      } else {
        // Pas de sauvegarde, on utilise l'ordre par d√©faut
        displayList = [...bookmarks];
      }

      // 2. G√©n√©rer le HTML
      displayList.forEach((group, index) => {
        const div = document.createElement("div");
        div.className = "bookmark-set";
        // On ajoute un data-id pour identifier la cat√©gorie lors du tri
        div.setAttribute('data-id', group.title);
        
        // Ajout d'un petit d√©lai d'animation (stagger)
        div.style.animationDelay = `${index * 0.05}s`;

        div.innerHTML = `
          <h3>${group.title}</h3>
          <div class="links-list">
            ${group.links.map(l => `
              <a href="${l.url}" target="_blank" class="link-item">
                <img src="https://www.google.com/s2/favicons?domain=${new URL(l.url).hostname}&sz=32" alt="" loading="lazy"/>
                <span>${l.name}</span>
              </a>
            `).join('')}
          </div>
        `;
        container.appendChild(div);
      });

      // 3. Activer SortableJS (Drag and Drop)
      Sortable.create(container, {
        animation: 150,
        handle: 'h3', // On ne peut attraper que par le titre (meilleur UX pour s√©lectionner le texte en dessous)
        ghostClass: 'sortable-ghost', // Classe CSS pendant le d√©placement (voir styles.css)
        dragClass: 'sortable-drag',   // Classe CSS de l'√©l√©ment en mouvement
        delay: 0, // Pas de d√©lai sur desktop
        delayOnTouchOnly: true, // D√©lai sur mobile pour ne pas g√™ner le scroll
        onEnd: function (evt) {
            saveOrder(); // Sauvegarde quand on l√¢che
        }
      });
    }

    // Fonction pour sauvegarder l'ordre actuel dans le LocalStorage
    function saveOrder() {
        const order = [];
        const items = document.querySelectorAll('#bookmarks-container .bookmark-set');
        items.forEach(item => {
            order.push(item.getAttribute('data-id'));
        });
        localStorage.setItem('bookmarksOrder', JSON.stringify(order));
    }

    // --- UI & Settings Logic ---
    (function initSettings() {
        const root = document.documentElement;
        
        // Panel Toggle
        $("#settings-btn").onclick = () => $("#settings-panel").hidden = false;
        $("#close-settings").onclick = () => $("#settings-panel").hidden = true;
        
        // Weather Details Toggle
        $("#weather-widget").onclick = () => $("#weather-details").hidden = false;
        $("#close-weather").onclick = () => $("#weather-details").hidden = true;
        
        // Reset
        $("#reset-settings").onclick = () => {
            localStorage.clear();
            location.reload();
        }

        // Generic setting handler
        const applySetting = (key, val, action) => {
            localStorage.setItem(key, val);
            action(val);
        };

        const setupSelector = (id, key, action, defaultVal) => {
            const el = $(id);
            const saved = localStorage.getItem(key) || defaultVal;
            el.value = saved;
            action(saved);
            el.addEventListener('change', () => applySetting(key, el.value, action));
        };

        // Theme & Density
        setupSelector('#theme-selector', 'theme', (val) => root.setAttribute('data-theme', val), matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
        setupSelector('#density-selector', 'density', (val) => root.setAttribute('data-density', val), 'cozy');
        
        // Toggle News
        const newsToggle = $('#news-toggle');
        const showNews = localStorage.getItem('showNews') !== 'false';
        newsToggle.checked = showNews;
        document.body.classList.toggle('news-hidden', !showNews);
        newsToggle.addEventListener('change', () => { 
            applySetting('showNews', newsToggle.checked, (val) => document.body.classList.toggle('news-hidden', !val)); 
        });

        // Toggle Chat
        const chatToggle = $('#chat-toggle'); const showChat = localStorage.getItem('showChat') !== 'false'; chatToggle.checked = showChat; document.body.classList.toggle('chat-hidden', !showChat);
        chatToggle.addEventListener('change', () => { applySetting('showChat', chatToggle.checked, (val) => document.body.classList.toggle('chat-hidden', !val)); });
    })();

    // --- Init ---
    window.addEventListener("load", () => {
      updateGreeting(); $("#clock").textContent = getTime();
      setInterval(() => { $("#clock").textContent = getTime(); if (new Date().getSeconds() === 0) updateGreeting(); }, 1000);
      setupBookmarks(); 
      getWeather();
      loadNews();
    });

  </script>
</body>
</html>
